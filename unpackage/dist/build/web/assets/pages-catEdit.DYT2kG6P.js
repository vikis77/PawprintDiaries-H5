import{l as a,m as e,a3 as l,M as t,p as o,u,a4 as d,r as s,a as r,w as i,g as n,o as c,d as m,v,f as p,Z as f,T as _,i as h,B as V,A as g}from"./index-CFSraVz9.js";import{a as b,_ as y}from"./uni-col.BqLUY_aA.js";import{r as k}from"./uni-app.es.klBOcF9e.js";import{_ as x}from"./uni-easyinput.BG8xWcF5.js";import{_ as U,a as q}from"./uni-forms.DPKVDRlQ.js";import{_ as w}from"./uni-file-picker.DnMTpDey.js";import{_ as S}from"./uni-datetime-picker.vue_vue_type_style_index_0_scoped_00b50588_lang.BQ88h-Fa.js";import{_ as j}from"./uni-datetime-picker.C08R0Dwt.js";import{_ as C}from"./返回.CROdAYn4.js";import{_ as z}from"./更多.BXBfdnkH.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.CIje-GWR.js";import"./uni-load-more.DRX41OXE.js";const F=$({__name:"catEdit",setup($){const F=a(""),I=a("");I.value="https://cdn.luckyiur.com/catcat",F.value="https://pawprintdiaries.luckyiur.com";const P=a(null),T=a([]),B=a([]),E=a([{text:"雄性",value:0},{text:"雌性",value:1},{text:"保密/不确定",value:2}]),G=a([{text:"已绝育",value:"已绝育"},{text:"未绝育",value:"未绝育"}]),R=a([{text:"已接种",value:"已接种"},{text:"未接种",value:"未接种"}]),A=a([{text:"健康",value:"健康"},{text:"肥胖",value:"肥胖"},{text:"营养不良",value:"营养不良"},{text:"疾病",value:"疾病"}]);e((()=>{l({title:"加载中..."});const a=new URLSearchParams(window.location.search).get("catId");console.log("Received catId:",a),function(a){t({url:`${F.value}/api/cat/findById?ID=${a}`,method:"GET",header:{Authorization:`Bearer ${o("token")}`},success:a=>{console.log(a.data.data),200===a.statusCode&&"2001"===a.data.code?u({title:a.data.msg||"身份信息过期，请重新登录",icon:"none"}):200===a.statusCode&&"2000"===a.data.code?(P.value=a.data.data,console.log(P.value)):u({title:a.data.msg||"获取小猫信息失败",icon:"none"}),console.log(a)},fail:a=>{u({title:"请求获取小猫信息失败，请重试",icon:"none"})}}),console.log(P.value),d()}(a)}));const D=()=>{_()},L=a=>{T.value=a.tempFilePaths,B.value=a.tempFiles,console.log("已选择的文件路径列表:",T.value),console.log("已选择的文件列表:",B.value)},M=a=>{const{tempFilePath:e,fileList:l}=a.detail;P.value.avatar=l,console.log("上传成功:",e)},O=a=>{console.error("上传失败:",a)},Z=async()=>{const a=P.value;console.log(P.value.avatar);const e=o("token");if(e){try{if(null!=T.value){const a=await t({url:`${F.value}/api/upload/qiniuUploadToken`,method:"GET",header:{Authorization:`Bearer ${e}`}});if(200!==a.statusCode||"2000"!==a.data.code)throw new Error("获取上传凭证失败");const l=a.data.data.qiniuToken,o=B.value.map((a=>new Promise(((e,t)=>{f({url:"https://upload-z2.qiniup.com",filePath:a.path,name:"file",formData:{token:l,key:`catcat/cat_avatar/${a.name}`},success:a=>{200===a.statusCode?e(a):t(new Error("图片上传失败"))},fail:a=>{t(a)}})})))),d=await Promise.all(o);console.log("所有图片上传成功:",d);const s=await t({url:`${F.value}/api/cat/update`,method:"POST",header:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},data:{catId:P.value.catId,catname:P.value.catname,gender:P.value.gender,age:P.value.age,brithday:P.value.datetimesingle,avatar:B.value[0].name,food:P.value.food,taboo:P.value.taboo,catCharacter:P.value.catCharacter,healthStatus:P.value.healthStatus,sterilizationStatus:P.value.sterilizationStatus,vaccinationStatus:P.value.vaccinationStatus,badRecord:P.value.badRecord,area:P.value.area,catGuide:P.value.catGuide}});200===s.statusCode&&"2000"===s.data.code?(console.log("已完成持久化猫猫",s),u({title:"提交成功",icon:"success"}),_()):(console.log("无法持久化",s),u({title:"提交失败",icon:"error"}))}}catch(l){console.error("提交过程中发生错误:",l),u({title:"提交失败",icon:"error"})}console.log("表单数据:",a),u({title:"提交成功",icon:"success"})}else u({title:"未找到有效的登录令牌",icon:"error"})};return(a,e)=>{const l=k(s("uni-col"),b),t=h,o=n,u=k(s("uni-row"),y),d=k(s("uni-easyinput"),x),f=k(s("uni-forms-item"),U),_=V,$=k(s("uni-file-picker"),w),F=k(s("uni-data-checkbox"),S),T=k(s("uni-datetime-picker"),j),B=g,H=k(s("uni-forms"),q);return c(),r(o,{class:"container"},{default:i((()=>[m(o,{class:"layout"},{default:i((()=>[m(o,{class:"t1"},{default:i((()=>[m(u,{class:"t9zdf",width:750},{default:i((()=>[m(l,{class:"tpk0u",span:8},{default:i((()=>[v("img",{src:C,alt:"",onClick:D,class:"img"})])),_:1}),m(l,{class:"tgq89",span:8},{default:i((()=>[m(o,{class:"t9gh9gh9"},{default:i((()=>[m(t,null,{default:i((()=>[p("猫猫编辑")])),_:1})])),_:1})])),_:1}),m(l,{class:"t56f7",span:8},{default:i((()=>[v("img",{src:z,alt:""})])),_:1})])),_:1})])),_:1}),m(o,{class:"v43ta"},{default:i((()=>[m(H,{ref:"baseForm",modelValue:P.value},{default:i((()=>[m(f,{label:"猫名",required:""},{default:i((()=>[m(d,{modelValue:P.value.catname,"onUpdate:modelValue":e[0]||(e[0]=a=>P.value.catname=a),placeholder:"请输入姓名"},null,8,["modelValue"])])),_:1}),m(f,{label:"头像",required:"",class:"hu00h"},{default:i((()=>[m($,{mode:"image","file-mediatype":["image"],limit:"1","auto-upload":!1,"file-list":P.value.avatar,onUploadSuccess:M,onUploadFail:O,onSelect:L},{default:i((()=>[P.value.avatar.length>0?(c(),r(o,{key:0},{default:i((()=>[m(_,{src:`${I.value}/cat_avatar/${P.value.avatar}`,mode:"aspectFill",class:"avatar-preview"},null,8,["src"])])),_:1})):(c(),r(o,{key:1,class:"upload-placeholder"},{default:i((()=>[p("点击上传头像")])),_:1})),m(o,null,{default:i((()=>[p("如上传新头像，不需要等待上传，继续填写，提交即可")])),_:1})])),_:1},8,["file-list"])])),_:1}),m(f,{label:"年龄(月)",required:""},{default:i((()=>[m(d,{modelValue:P.value.age,"onUpdate:modelValue":e[1]||(e[1]=a=>P.value.age=a),placeholder:"请输入年龄"},null,8,["modelValue"])])),_:1}),m(f,{label:"性别",required:""},{default:i((()=>[m(F,{modelValue:P.value.gender,"onUpdate:modelValue":e[2]||(e[2]=a=>P.value.gender=a),localdata:E.value},null,8,["modelValue","localdata"])])),_:1}),m(f,{label:"种类",required:""},{default:i((()=>[m(d,{modelValue:P.value.gender,"onUpdate:modelValue":e[3]||(e[3]=a=>P.value.gender=a),placeholder:"请输入品种"},null,8,["modelValue"])])),_:1}),m(f,{label:"常住地",required:""},{default:i((()=>[m(d,{modelValue:P.value.area,"onUpdate:modelValue":e[4]||(e[4]=a=>P.value.area=a),placeholder:"请输入区域"},null,8,["modelValue"])])),_:1}),m(f,{label:"绝育",required:""},{default:i((()=>[m(F,{modelValue:P.value.sterilizationStatus,"onUpdate:modelValue":e[5]||(e[5]=a=>P.value.sterilizationStatus=a),localdata:G.value},null,8,["modelValue","localdata"])])),_:1}),m(f,{label:"疫苗",required:""},{default:i((()=>[m(F,{modelValue:P.value.vaccinationStatus,"onUpdate:modelValue":e[6]||(e[6]=a=>P.value.vaccinationStatus=a),localdata:R.value},null,8,["modelValue","localdata"])])),_:1}),m(f,{label:"健康状态",required:""},{default:i((()=>[m(F,{modelValue:P.value.healthStatus,"onUpdate:modelValue":e[7]||(e[7]=a=>P.value.healthStatus=a),localdata:A.value},null,8,["modelValue","localdata"])])),_:1}),m(f,{label:"性格",required:""},{default:i((()=>[m(d,{modelValue:P.value.catCharacter,"onUpdate:modelValue":e[8]||(e[8]=a=>P.value.catCharacter=a),placeholder:"请输入猫猫性格"},null,8,["modelValue"])])),_:1}),m(f,{label:"食物偏好",required:""},{default:i((()=>[m(d,{modelValue:P.value.food,"onUpdate:modelValue":e[9]||(e[9]=a=>P.value.food=a),placeholder:"请输入偏好"},null,8,["modelValue"])])),_:1}),m(f,{label:"忌讳",required:""},{default:i((()=>[m(d,{modelValue:P.value.taboo,"onUpdate:modelValue":e[10]||(e[10]=a=>P.value.taboo=a),placeholder:"请输入忌讳"},null,8,["modelValue"])])),_:1}),m(f,{label:"不良行为记录"},{default:i((()=>[m(d,{type:"textarea",modelValue:P.value.badRecord,"onUpdate:modelValue":e[11]||(e[11]=a=>P.value.badRecord=a),placeholder:"请输入不良行为记录"},null,8,["modelValue"])])),_:1}),m(f,{label:"撸猫指南"},{default:i((()=>[m(d,{type:"textarea",modelValue:P.value.catGuide,"onUpdate:modelValue":e[12]||(e[12]=a=>P.value.catGuide=a),placeholder:"请输入撸猫指南"},null,8,["modelValue"])])),_:1}),m(f,{label:"生日"},{default:i((()=>[m(T,{type:"datetime","return-type":"timestamp",modelValue:P.value.brithday,"onUpdate:modelValue":e[13]||(e[13]=a=>P.value.brithday=a)},null,8,["modelValue"])])),_:1}),m(o,{class:"form-buttons"},{default:i((()=>[m(B,{type:"primary",onClick:Z},{default:i((()=>[p("提交")])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-a9920177"]]);export{F as default};
