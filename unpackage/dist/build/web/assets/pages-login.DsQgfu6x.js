import{l as e,a,w as t,g as s,o as l,d as o,v as n,f as r,z as c,U as i,u,M as d,s as p,Q as f,i as m,Y as g,A as h}from"./index-CFSraVz9.js";import{_}from"./返回.CROdAYn4.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";class v extends Error{}function w(e){let a=e.replace(/-/g,"+").replace(/_/g,"/");switch(a.length%4){case 0:break;case 2:a+="==";break;case 3:a+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function(e){return decodeURIComponent(atob(e).replace(/(.)/g,((e,a)=>{let t=a.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t})))}(a)}catch(t){return atob(a)}}v.prototype.name="InvalidTokenError";const b=k({__name:"login",setup(k){const b=e("");e("").value="https://cdn.luckyiur.com/catcat",b.value="https://pawprintdiaries.luckyiur.com";const y=e(""),I=e(""),x=()=>{c({url:"/pages/register"})},C=()=>{i({url:"/pages/Home"})},V=()=>{y.value&&I.value||u({title:"请填写完整信息",icon:"none"}),d({url:`${b.value}/api/user/login`,method:"POST",data:{username:y.value,password:I.value},success:e=>{if(console.log(e),200===e.statusCode&&"2000"===e.data.code){const t=e.data.data.token;if(p("token",t),t)try{const e=function(e,a){if("string"!=typeof e)throw new v("Invalid token specified: must be a string");a||(a={});const t=!0===a.header?0:1,s=e.split(".")[t];if("string"!=typeof s)throw new v(`Invalid token specified: missing part #${t+1}`);let l;try{l=w(s)}catch(o){throw new v(`Invalid token specified: invalid base64 for part #${t+1} (${o.message})`)}try{return JSON.parse(l)}catch(o){throw new v(`Invalid token specified: invalid json for part #${t+1} (${o.message})`)}}(t);console.log("Decoded Token:",e);e.username,e.userId;const a={exp:e.exp,username:e.sub,userId:e.jti};p("tokenDetail",a)}catch(a){console.error("Token 解码失败:",a)}u({title:"登录成功",icon:"success"}),f({url:"/pages/Home"})}else u({title:e.data.msg||"登录失败",icon:"none"})},fail:()=>{u({title:"请求失败，请重试",icon:"none"})}})};return(e,c)=>{const i=s,u=m,d=g,p=h;return l(),a(i,{class:"container"},{default:t((()=>[o(i,{class:"layout"},{default:t((()=>[o(i,{class:"t9h0h"},{default:t((()=>[o(i,{class:"back-button",onClick:C},{default:t((()=>[n("img",{class:"back-icon",src:_,alt:""})])),_:1})])),_:1}),o(i,{class:"header"},{default:t((()=>[o(u,{class:"title"},{default:t((()=>[r("登录")])),_:1})])),_:1}),o(i,{class:"form"},{default:t((()=>[o(i,{class:"input-item"},{default:t((()=>[o(d,{class:"input",focus:"",modelValue:y.value,"onUpdate:modelValue":c[0]||(c[0]=e=>y.value=e),placeholder:"邮箱/账号"},null,8,["modelValue"])])),_:1}),o(i,{class:"input-item"},{default:t((()=>[o(d,{class:"input",type:"password",placeholder:"密码",modelValue:I.value,"onUpdate:modelValue":c[1]||(c[1]=e=>I.value=e)},null,8,["modelValue"]),o(i,{class:"input-eye"})])),_:1})])),_:1}),o(i,{class:"footer"},{default:t((()=>[o(i,{class:"footer-text"},{default:t((()=>[r(" 还没有账号？ "),o(u,{onClick:x,class:"link"},{default:t((()=>[r("立即注册")])),_:1})])),_:1})])),_:1}),o(p,{class:"submit-button",onClick:V,type:"primary"},{default:t((()=>[r("登录")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-f675e074"]]);export{b as default};
